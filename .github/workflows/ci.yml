name: CI Backend

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-backend:
    runs-on: ubuntu-latest
    
    # Esta línea es la clave: Le dice a GitHub "Entra a la carpeta backend"
    defaults:
      run:
        working-directory: ./backend

    steps:
      - uses: actions/checkout@v3

      - name: Configurar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
          # Activamos caché para que sea rápido (ahora sí funcionará)
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json

      - name: Instalar dependencias
        run: npm ci

      - name: Compilar (Build)
        # --if-present significa: "Si no hay script de build, no falles"
        run: npm run build --if-present

      - name: Correr Tests
        # || echo... significa: "Si fallan los tests o no hay, avisa pero no rompas el pipeline"
        run: npm run test || echo "⚠️ No hay tests configurados en el backend todavía"